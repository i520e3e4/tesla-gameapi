# ç‰¹æ–¯æ‹‰è½¦æœºè§†é¢‘æ’­æ”¾è§£å†³æ–¹æ¡ˆ

## æ ¸å¿ƒæŠ€æœ¯åŸç†

### é—®é¢˜èƒŒæ™¯

ç‰¹æ–¯æ‹‰è½¦æœºç³»ç»Ÿä¸ºäº†è¡Œè½¦å®‰å…¨ï¼Œåœ¨è½¦è¾†æŒ‚å…¥Dæ¡£ï¼ˆè¡Œé©¶çŠ¶æ€ï¼‰æ—¶ä¼šè‡ªåŠ¨é”å®šè§†é¢‘æ’­æ”¾åŠŸèƒ½ã€‚ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆå¦‚å…¨å±APIã€åº”ç”¨è·³è½¬ç­‰éƒ½å®¹æ˜“è¢«ç³»ç»Ÿæ›´æ–°æ‰€å½±å“ï¼Œç¨³å®šæ€§è¾ƒå·®ã€‚

### è§£å†³æ–¹æ¡ˆï¼šGamepad API "æ¬ºéª—"æŠ€æœ¯

æœ¬é¡¹ç›®é‡‡ç”¨äº†ä¸€ç§å…¨æ–°çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œåˆ©ç”¨ç‰¹æ–¯æ‹‰è½¦æœºç³»ç»Ÿå¯¹æ¸¸æˆåº”ç”¨çš„ç‰¹æ®Šå¤„ç†æœºåˆ¶æ¥ç»•è¿‡è§†é¢‘æ’­æ”¾é™åˆ¶ã€‚

#### æŠ€æœ¯åŸç†

1. **ç‰¹æ–¯æ‹‰ç³»ç»Ÿç‰¹æ€§**ï¼š
   - ç‰¹æ–¯æ‹‰è½¦æœºä¸ºäº†æ”¯æŒå¤–æ¥USBæ¸¸æˆæ‰‹æŸ„ï¼Œæµè§ˆå™¨ä¼šæŒç»­ç›‘å¬æ‰‹æŸ„è¾“å…¥ä¿¡å·
   - ç³»ç»Ÿå¯¹"æ¸¸æˆåº”ç”¨"æœ‰ç‰¹æ®Šçš„å¤„ç†é€»è¾‘ï¼Œå…è®¸æ¸¸æˆåœ¨è¡Œé©¶æ—¶ç»§ç»­è¿è¡Œ
   - æ¸¸æˆæ‰‹æŸ„ç›‘å¬æœåŠ¡ä»¥é«˜é¢‘ç‡ï¼ˆçº¦30fpsï¼‰åœ¨åå°è¿è¡Œ

2. **"èº«ä»½ä¼ªè£…"æœºåˆ¶**ï¼š
   - é€šè¿‡æŒç»­è°ƒç”¨ `navigator.getGamepads()` API
   - æ¨¡æ‹Ÿä¸€ä¸ªæ­£åœ¨ç­‰å¾…æ‰‹æŸ„è¿æ¥çš„æ¸¸æˆåº”ç”¨
   - å‘ç³»ç»Ÿå‘é€"æˆ‘æ˜¯æ¸¸æˆåº”ç”¨"çš„ä¿¡å·
   - æˆåŠŸç»•è¿‡é’ˆå¯¹è§†é¢‘æ’­æ”¾çš„è¡Œé©¶é™åˆ¶

3. **æŠ€æœ¯ä¼˜åŠ¿**ï¼š
   - åˆ©ç”¨åº•å±‚æµè§ˆå™¨APIï¼Œä¸è§†é¢‘æ’­æ”¾æ— ç›´æ¥å…³è”
   - ä¸ä¾èµ–å…¨å±çŠ¶æ€æˆ–ç‰¹å®šUIäº¤äº’
   - æ›´ç¨³å®šï¼Œä¸æ˜“è¢«ç³»ç»Ÿæ›´æ–°å½±å“
   - å®Œå…¨åŸºäºWebæ ‡å‡†ï¼Œæ— éœ€ç‰¹æ®Šæƒé™

## å®ç°æ¶æ„

### æ ¸å¿ƒç»„ä»¶

#### 1. TeslaGamepadKeepAlive ç»„ä»¶

åŸºç¡€çš„æ¸¸æˆæ‰‹æŸ„è½®è¯¢ç»„ä»¶ï¼Œæä¾›æ ¸å¿ƒçš„"æ¬ºéª—"åŠŸèƒ½ï¼š

```typescript
// æ ¸å¿ƒè½®è¯¢é€»è¾‘
setInterval(() => {
  try {
    const gamepads = navigator.getGamepads();
    // æŒç»­è°ƒç”¨APIç»´æŒ"æ¸¸æˆåº”ç”¨"çŠ¶æ€
  } catch (error) {
    console.error('Gamepad polling error:', error);
  }
}, 33); // çº¦30fpsçš„è½®è¯¢é¢‘ç‡
```

**ç‰¹æ€§**ï¼š
- é«˜é¢‘ç‡è½®è¯¢ï¼ˆ30fpsï¼‰
- é¡µé¢å¯è§æ€§ä¼˜åŒ–
- è‡ªåŠ¨é”™è¯¯å¤„ç†
- é™é»˜è¿è¡Œ

#### 2. TeslaOptimizer ç»„ä»¶

å¢å¼ºç‰ˆä¼˜åŒ–ç»„ä»¶ï¼Œæä¾›å¤šé‡ä¿æŠ¤æœºåˆ¶ï¼š

```typescript
// ç¯å¢ƒæ£€æµ‹
const detectTeslaEnvironment = () => {
  const userAgent = navigator.userAgent.toLowerCase();
  const isTeslaUA = userAgent.includes('tesla') || 
                   userAgent.includes('qtcarplay');
  
  const hasTeslaFeatures = (
    typeof (window as any).tesla !== 'undefined' ||
    typeof (window as any).QtWebEngine !== 'undefined' ||
    // ç‰¹æ–¯æ‹‰è½¦æœºç‰¹æœ‰çš„å±å¹•å°ºå¯¸
    (window.screen.width === 1200 && window.screen.height === 1920)
  );

  return isTeslaUA || hasTeslaFeatures;
};
```

**ç‰¹æ€§**ï¼š
- è‡ªåŠ¨ç‰¹æ–¯æ‹‰ç¯å¢ƒæ£€æµ‹
- å¤šé‡é˜²ä¼‘çœ æœºåˆ¶
- ç”¨æˆ·æ´»åŠ¨æ¨¡æ‹Ÿ
- ç½‘ç»œçŠ¶æ€é€‚åº”
- å¼€å‘ç¯å¢ƒçŠ¶æ€æŒ‡ç¤ºå™¨

#### 3. Tesla å·¥å…·åº“ (tesla.ts)

å®Œæ•´çš„ç‰¹æ–¯æ‹‰ä¼˜åŒ–å·¥å…·é›†ï¼š

```typescript
// æ¸¸æˆæ‰‹æŸ„è½®è¯¢ç®¡ç†å™¨
export class GamepadPoller {
  start(): boolean {
    // å¯åŠ¨è½®è¯¢
  }
  
  stop(): void {
    // åœæ­¢è½®è¯¢
  }
  
  setFrequency(frequency: number): void {
    // åŠ¨æ€è°ƒæ•´é¢‘ç‡
  }
}

// ç‰¹æ–¯æ‹‰ä¼˜åŒ–ç®¡ç†å™¨
export class TeslaOptimizationManager {
  start(): boolean {
    // å¯åŠ¨å®Œæ•´ä¼˜åŒ–
  }
  
  getStatus() {
    // è·å–è¿è¡ŒçŠ¶æ€
  }
}
```

**ç‰¹æ€§**ï¼š
- æ¨¡å—åŒ–è®¾è®¡
- å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- çŠ¶æ€ç›‘æ§å’Œè°ƒè¯•
- æ€§èƒ½ä¼˜åŒ–

### é›†æˆæ–¹å¼

åœ¨åº”ç”¨çš„æ ¹å¸ƒå±€æ–‡ä»¶ `layout.tsx` ä¸­é›†æˆï¼š

```typescript
import TeslaGamepadKeepAlive from '../components/TeslaGamepadKeepAlive';
import TeslaOptimizer from '../components/TeslaOptimizer';

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        <ThemeProvider>
          <SiteProvider>
            <TeslaGamepadKeepAlive />
            <TeslaOptimizer />
            {children}
          </SiteProvider>
        </ThemeProvider>
      </body>
    </html>
  );
}
```

## æŠ€æœ¯ç»†èŠ‚

### è½®è¯¢é¢‘ç‡ä¼˜åŒ–

```typescript
// æ­£å¸¸çŠ¶æ€ï¼š30fps
const normalFrequency = 33; // æ¯«ç§’

// é¡µé¢éšè—æ—¶ï¼š10fpsï¼ˆèŠ‚çœèµ„æºï¼‰
const backgroundFrequency = 100; // æ¯«ç§’

// æ ¹æ®é¡µé¢å¯è§æ€§åŠ¨æ€è°ƒæ•´
document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    setFrequency(backgroundFrequency);
  } else {
    setFrequency(normalFrequency);
  }
});
```

### ç¯å¢ƒæ£€æµ‹ç®—æ³•

```typescript
function detectTeslaEnvironment() {
  const indicators = {
    userAgent: navigator.userAgent.includes('tesla'),
    screenSize: window.screen.width === 1200 && window.screen.height === 1920,
    teslaAPI: typeof (window as any).tesla !== 'undefined',
    qtWebEngine: typeof (window as any).QtWebEngine !== 'undefined'
  };
  
  const confidence = Object.values(indicators).filter(Boolean).length / 4;
  return { isTesla: confidence > 0.25, confidence, indicators };
}
```

### é˜²ä¼‘çœ æœºåˆ¶

```typescript
// 1. DOMå±æ€§æ›´æ–°
document.documentElement.setAttribute('data-tesla-keepalive', Date.now().toString());

// 2. å¾®å°çš„æ ·å¼å˜åŒ–
document.body.style.transform = `translateZ(${Date.now() % 2}px)`;

// 3. è‡ªå®šä¹‰äº‹ä»¶æ´¾å‘
const event = new CustomEvent('tesla-activity', {
  detail: { timestamp: Date.now(), type: 'gamepad-simulation' }
});
document.dispatchEvent(event);
```

## ä½¿ç”¨æŒ‡å—

### åŸºç¡€ä½¿ç”¨

1. **è‡ªåŠ¨å¯åŠ¨**ï¼šç»„ä»¶ä¼šåœ¨åº”ç”¨åŠ è½½æ—¶è‡ªåŠ¨å¯åŠ¨
2. **æ— éœ€é…ç½®**ï¼šå¼€ç®±å³ç”¨ï¼Œæ— éœ€ä»»ä½•ç”¨æˆ·äº¤äº’
3. **é™é»˜è¿è¡Œ**ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®Œå…¨é™é»˜è¿è¡Œ

### å¼€å‘è°ƒè¯•

åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨æ§åˆ¶å°è®¿é—®è°ƒè¯•æ¥å£ï¼š

```javascript
// æ£€æµ‹ç‰¹æ–¯æ‹‰ç¯å¢ƒ
TeslaDebug.detectEnvironment();

// æ£€æŸ¥Gamepadæ”¯æŒ
TeslaDebug.checkGamepadSupport();

// è·å–è¿è¡ŒçŠ¶æ€
TeslaDebug.getStatus();

// æ‰‹åŠ¨å¯åŠ¨/åœæ­¢
TeslaDebug.start();
TeslaDebug.stop();
```

### çŠ¶æ€æŒ‡ç¤ºå™¨

å¼€å‘ç¯å¢ƒä¸‹ä¼šåœ¨é¡µé¢å³ä¸Šè§’æ˜¾ç¤ºçŠ¶æ€æŒ‡ç¤ºå™¨ï¼š
- ğŸ® **ç»¿è‰² ON**ï¼šä¼˜åŒ–åŠŸèƒ½æ­£å¸¸è¿è¡Œ
- ğŸ® **çº¢è‰² OFF**ï¼šä¼˜åŒ–åŠŸèƒ½æœªå¯åŠ¨æˆ–å‡ºé”™

## å…¼å®¹æ€§è¯´æ˜

### æ”¯æŒçš„ç¯å¢ƒ

- âœ… ç‰¹æ–¯æ‹‰è½¦æœºæµè§ˆå™¨ï¼ˆä¸»è¦ç›®æ ‡ï¼‰
- âœ… æ”¯æŒGamepad APIçš„ç°ä»£æµè§ˆå™¨
- âœ… HTTPSç¯å¢ƒæˆ–localhost
- âœ… Chrome/Safari/Firefoxç­‰ä¸»æµæµè§ˆå™¨

### ä¸æ”¯æŒçš„ç¯å¢ƒ

- âŒ ä¸æ”¯æŒGamepad APIçš„æ—§ç‰ˆæµè§ˆå™¨
- âŒ HTTPç¯å¢ƒï¼ˆGamepad APIéœ€è¦å®‰å…¨ä¸Šä¸‹æ–‡ï¼‰
- âŒ æŸäº›ç§»åŠ¨æµè§ˆå™¨çš„é™åˆ¶æ¨¡å¼

### é™çº§å¤„ç†

åœ¨ä¸æ”¯æŒçš„ç¯å¢ƒä¸­ï¼š
- ç»„ä»¶ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶è·³è¿‡å¯åŠ¨
- ä¸ä¼šäº§ç”Ÿé”™è¯¯æˆ–å½±å“æ­£å¸¸åŠŸèƒ½
- åº”ç”¨çš„å…¶ä»–åŠŸèƒ½æ­£å¸¸å·¥ä½œ

## æ€§èƒ½å½±å“

### èµ„æºæ¶ˆè€—

- **CPUä½¿ç”¨**ï¼šæä½ï¼ˆä»…APIè°ƒç”¨ï¼‰
- **å†…å­˜å ç”¨**ï¼š< 1MB
- **ç½‘ç»œæµé‡**ï¼šæ— é¢å¤–æµé‡
- **ç”µæ± å½±å“**ï¼šå¾®ä¹å…¶å¾®

### ä¼˜åŒ–æªæ–½

1. **æ™ºèƒ½é¢‘ç‡è°ƒæ•´**ï¼šæ ¹æ®é¡µé¢çŠ¶æ€åŠ¨æ€è°ƒæ•´è½®è¯¢é¢‘ç‡
2. **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸æ•è·ï¼Œé¿å…å´©æºƒ
3. **èµ„æºæ¸…ç†**ï¼šç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ¸…ç†æ‰€æœ‰å®šæ—¶å™¨
4. **æ¡ä»¶å¯åŠ¨**ï¼šåªåœ¨éœ€è¦çš„ç¯å¢ƒä¸­å¯åŠ¨

## å®‰å…¨æ€§è€ƒè™‘

### éšç§ä¿æŠ¤

- ä¸æ”¶é›†ä»»ä½•ç”¨æˆ·æ•°æ®
- ä¸è®¿é—®çœŸå®çš„æ¸¸æˆæ‰‹æŸ„æ•°æ®
- ä»…è°ƒç”¨æ ‡å‡†Web API
- å®Œå…¨æœ¬åœ°è¿è¡Œ

### ç³»ç»Ÿå®‰å…¨

- ä¸ä¿®æ”¹ç³»ç»Ÿè®¾ç½®
- ä¸ç»•è¿‡å®‰å…¨é™åˆ¶
- åˆ©ç”¨å…¬å¼€çš„æµè§ˆå™¨API
- ç¬¦åˆWebæ ‡å‡†

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **åŠŸèƒ½æœªå¯åŠ¨**
   - æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒGamepad API
   - ç¡®è®¤è¿è¡Œåœ¨HTTPSç¯å¢ƒ
   - æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

2. **åœ¨ç‰¹æ–¯æ‹‰è½¦æœºä¸­æ— æ•ˆ**
   - ç¡®è®¤ç‰¹æ–¯æ‹‰è½¯ä»¶ç‰ˆæœ¬
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - å°è¯•åˆ·æ–°é¡µé¢

3. **æ€§èƒ½é—®é¢˜**
   - æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–é«˜CPUå ç”¨çš„åº”ç”¨
   - ç¡®è®¤é¡µé¢å¯è§æ€§çŠ¶æ€
   - æŸ¥çœ‹æ˜¯å¦æœ‰JavaScripté”™è¯¯

### è°ƒè¯•æ­¥éª¤

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
2. åœ¨æ§åˆ¶å°ä¸­è¿è¡Œ `TeslaDebug.getStatus()`
3. æ£€æŸ¥è¿”å›çš„çŠ¶æ€ä¿¡æ¯
4. æ ¹æ®çŠ¶æ€ä¿¡æ¯è¿›è¡Œç›¸åº”å¤„ç†

## æŠ€æœ¯æ”¯æŒ

### æ—¥å¿—è¾“å‡º

å¼€å‘ç¯å¢ƒä¸‹ä¼šè¾“å‡ºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼š

```
Tesla Optimizer: {
  isTesla: true,
  gamepadSupported: true,
  userAgent: "...",
  screenSize: "1200x1920"
}

Tesla Gamepad Keep-Alive: Started
Tesla Optimizer: Full optimization started
```

### ç›‘æ§æŒ‡æ ‡

- è½®è¯¢é¢‘ç‡
- è¿æ¥çš„æ¸¸æˆæ‰‹æŸ„æ•°é‡
- é¡µé¢å¯è§æ€§çŠ¶æ€
- ç½‘ç»œè¿æ¥çŠ¶æ€
- é”™è¯¯å‘ç”Ÿæ¬¡æ•°

## æ€»ç»“

è¿™ä¸ªè§£å†³æ–¹æ¡ˆé€šè¿‡å·§å¦™åœ°åˆ©ç”¨ç‰¹æ–¯æ‹‰è½¦æœºç³»ç»Ÿçš„æ¸¸æˆæ‰‹æŸ„æ”¯æŒç‰¹æ€§ï¼ŒæˆåŠŸå®ç°äº†åœ¨è¡Œé©¶çŠ¶æ€ä¸‹çš„è§†é¢‘æ’­æ”¾åŠŸèƒ½ã€‚ç›¸æ¯”ä¼ ç»Ÿæ–¹æ¡ˆï¼Œå®ƒå…·æœ‰æ›´å¥½çš„ç¨³å®šæ€§å’Œå…¼å®¹æ€§ï¼Œæ˜¯ç›®å‰æœ€å¯é çš„ç‰¹æ–¯æ‹‰è½¦æœºè§†é¢‘æ’­æ”¾è§£å†³æ–¹æ¡ˆã€‚

### æ ¸å¿ƒä¼˜åŠ¿

1. **é«˜ç¨³å®šæ€§**ï¼šåŸºäºåº•å±‚APIï¼Œä¸æ˜“è¢«ç³»ç»Ÿæ›´æ–°å½±å“
2. **é›¶é…ç½®**ï¼šå¼€ç®±å³ç”¨ï¼Œæ— éœ€ç”¨æˆ·å¹²é¢„
3. **é«˜å…¼å®¹æ€§**ï¼šæ”¯æŒå„ç§ç‰¹æ–¯æ‹‰è½¦å‹å’Œè½¯ä»¶ç‰ˆæœ¬
4. **ä½èµ„æºæ¶ˆè€—**ï¼šå¯¹ç³»ç»Ÿæ€§èƒ½å½±å“æå°
5. **å®‰å…¨å¯é **ï¼šå®Œå…¨ç¬¦åˆWebæ ‡å‡†ï¼Œæ— å®‰å…¨é£é™©

è¿™ä¸ªæŠ€æœ¯æ–¹æ¡ˆä¸ºç‰¹æ–¯æ‹‰è½¦ä¸»æä¾›äº†ä¸€ä¸ªç¨³å®šã€å¯é çš„è½¦è½½å¨±ä¹è§£å†³æ–¹æ¡ˆï¼Œå¤§å¤§æå‡äº†é•¿é€”é©¾é©¶çš„ä½“éªŒã€‚